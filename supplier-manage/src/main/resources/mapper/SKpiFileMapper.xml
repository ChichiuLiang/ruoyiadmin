<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.supplier.mapper.SKpiFileMapper">
    
    <resultMap type="SKpiFile" id="SKpiFileResult">
        <result property="id"    column="id"    />
        <result property="kpiId"    column="kpi_id"    />
        <result property="fileName"    column="file_name"    />
        <result property="filePath"    column="file_path"    />
        <result property="fileSize"    column="file_size"    />
        <result property="delFlag"    column="del_flag"    />
    </resultMap>

    <sql id="selectSKpiFileVo">
        select id, kpi_id, file_name, file_path,file_size, del_flag from s_kpi_file
    </sql>

    <select id="selectSKpiFileList" parameterType="SKpiFile" resultMap="SKpiFileResult">
        <include refid="selectSKpiFileVo"/>
        <where>  
            <if test="kpiId != null "> and kpi_id = #{kpiId}</if>
            <if test="fileName != null  and fileName != ''"> and file_name like concat(concat('%', #{fileName}), '%')</if>
            <if test="filePath != null  and filePath != ''"> and file_path = #{filePath}</if>
        </where>
    </select>
    
    <select id="selectAllSKpiFileList" parameterType="SKpi" resultMap="SKpiFileResult">
		select a.id,a.kpi_id,a.file_name, a.file_path,a.file_size from s_kpi_file a
		where a.kpi_id in
  		<foreach item="item" collection="list" open="(" separator="," close=")">
            #{item.id}
        </foreach>
        order by a.id
	</select>
    
    <select id="selectSKpiFileById" parameterType="Long" resultMap="SKpiFileResult">
        <include refid="selectSKpiFileVo"/>
        where del_flag = '0' and id = #{id}
    </select>
    
    <select id="selectSKpiFileListByKpiId" parameterType="Long" resultMap="SKpiFileResult">
        <include refid="selectSKpiFileVo"/>
        where del_flag = '0' and kpi_id = #{kpiId}
        order by id
    </select>
        
    <insert id="insertSKpiFile" parameterType="SKpiFile">
        <selectKey keyProperty="id" resultType="long" order="BEFORE">
            SELECT seq_s_kpi_file.NEXTVAL as id FROM DUAL
        </selectKey>
        insert into s_kpi_file
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">id,</if>
            <if test="kpiId != null">kpi_id,</if>
            <if test="fileName != null">file_name,</if>
            <if test="filePath != null">file_path,</if>
            <if test="fileSize != null">file_size,</if>
            <if test="delFlag != null">del_flag,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">#{id},</if>
            <if test="kpiId != null">#{kpiId},</if>
            <if test="fileName != null">#{fileName},</if>
            <if test="filePath != null">#{filePath},</if>
            <if test="fileSize != null">#{fileSize},</if>
            <if test="delFlag != null">#{delFlag},</if>
         </trim>
    </insert>
    
    
    <insert id="batchInsertSKpiFile" useGeneratedKeys="false" >
	    insert into s_kpi_file(id,kpi_id,file_name,file_path,file_size)
		<foreach item="item" collection="list" separator="union all">
			select seq_s_kpi_file.NEXTVAL,#{item.kpiId},#{item.fileName},#{item.filePath},#{item.fileSize} from dual
		</foreach>
	</insert>

    <update id="updateSKpiFile" parameterType="SKpiFile">
        update s_kpi_file
        <trim prefix="SET" suffixOverrides=",">
            <if test="kpiId != null">kpi_id = #{kpiId},</if>
            <if test="fileName != null">file_name = #{fileName},</if>
            <if test="filePath != null">file_path = #{filePath},</if>
            <if test="delFlag != null">del_flag = #{delFlag},</if>
        </trim>
        where id = #{id}
    </update>
    
    <update id="updateSKpiFileByKpiId" parameterType="Long">
        update s_kpi_file set del_flag = '1' where kpi_id = #{kpiId}
    </update>

    <delete id="deleteSKpiFileById" parameterType="Long">
        delete from s_kpi_file where id = #{id}
    </delete>

    <delete id="deleteSKpiFileByIds" parameterType="String">
        delete from s_kpi_file where id in 
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
</mapper>